<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üêü AI Fish Detector Pro - Advanced Detection System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #00b4a6;
            --secondary: #006b8c;
            --accent: #00e5d0;
            --danger: #f56565;
            --success: #48bb78;
            --warning: #ed8936;
            --dark: #1a202c;
            --light: #f7fafc;
            --shadow-sm: 0 4px 15px rgba(0, 180, 166, 0.1);
            --shadow-md: 0 10px 40px rgba(0, 180, 166, 0.15);
            --shadow-lg: 0 20px 60px rgba(0, 180, 166, 0.2);
            --transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e3a5f 50%, #0d3a4a 100%);
            color: #2d3748;
            min-height: 100vh;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(0, 180, 166, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(0, 229, 208, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        /* ===== HEADER STYLES ===== */
        .header {
            position: fixed;
            top: 0;
            width: 100%;
            background: linear-gradient(135deg, rgba(0, 180, 166, 0.98), rgba(76, 124, 122, 0.98));
            backdrop-filter: blur(25px) saturate(200%);
            box-shadow: 0 10px 40px rgba(0, 180, 166, 0.3),
                        inset 0 1px 0 rgba(255, 255, 255, 0.2);
            z-index: 1000;
            border-bottom: 3px solid rgba(0, 229, 208, 0.5);
            height: 90px;
            transition: all 0.5s cubic-bezier(0.4,0,0.2,1);
        }

        .header.scrolled {
            background: transparent !important;
            backdrop-filter: none !important;
            box-shadow: none !important;
            border-bottom: none !important;
        }

        .header-container {
            width: 100%;
            margin: 0;
            padding: 0 40px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 100px;
            position: relative;
            z-index: 1;
            transition: height 0.5s cubic-bezier(0.4,0,0.2,1);
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 18px;
            padding: 8px 12px 8px 0;
            cursor: pointer;
            transition: var(--transition);
        }

        .logo-section:hover {
            transform: scale(1.05);
        }

        .logo-icon {
            width: 90px;
            height: 90px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
        }

        .logo-text {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .logo-text .main-title {
            font-size: 1.55rem;
            font-weight: 900;
            color: #ffffff;
            line-height: 1.2;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            text-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .logo-text .subtitle {
            font-size: 0.98rem;
            color: rgba(255,255,255,0.9);
            font-weight: 600;
            letter-spacing: 0.6px;
            text-shadow: 0 1px 4px rgba(0,0,0,0.2);
        }

        .top-bar {
            display: flex;
            align-items: center;
            gap: 14px;
            margin-left: auto;
        }

        .user-greeting {
            display: flex;
            align-items: center;
            padding: 11px 22px;
            background: rgba(255,255,255,0.2);
            border-radius: 28px;
            margin-right: 12px;
            border: 2px solid rgba(255,255,255,0.3);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .greeting-text {
            font-size: 1rem;
            font-weight: 700;
            color: #fff;
            letter-spacing: 0.3px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .top-bar a,
        .top-bar details summary {
            color: #ffffff;
            text-decoration: none;
            padding: 11px 20px;
            font-size: 0.92rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.6px;
            cursor: pointer;
            border-radius: 12px;
            position: relative;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: all 0.4s;
        }

        .top-bar a:hover,
        .top-bar details summary:hover {
            color: #ffffff;
            background: rgba(255,255,255,0.2);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .top-bar details {
            position: relative;
        }

        .top-bar details summary {
            list-style: none;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .top-bar details summary::after {
            content: '‚ñº';
            font-size: 0.7rem;
            margin-left: 6px;
            transition: transform 0.5s;
        }

        .top-bar details[open] summary::after {
            transform: rotate(180deg);
        }

        .top-bar details ul {
            position: absolute;
            top: calc(100% + 10px);
            left: 0;
            right: auto;
            background: rgba(255,255,255,0.98);
            backdrop-filter: blur(25px) saturate(200%);
            box-shadow: 0 15px 50px rgba(0,0,0,0.3);
            border-radius: 18px;
            min-width: 240px;
            margin-top: 0;
            overflow: hidden;
            list-style: none;
            padding: 14px 0;
            border: 2px solid rgba(0,180,166,0.3);
            z-index: 1001;
            animation: dropdownSlide 0.5s;
        }

        @keyframes dropdownSlide {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: none;
            }
        }

        .top-bar details ul li a {
            display: block;
            padding: 13px 24px;
            color: #333;
            text-decoration: none;
            font-size: 0.92rem;
            text-transform: none;
            transition: all 0.4s;
        }

        .top-bar details ul li a:hover {
            background: linear-gradient(90deg,#00b4a6,#006b8c);
            color: white;
            padding-left: 36px;
            transform: translateX(6px);
        }

        .logout {
            background: linear-gradient(135deg,#dc3545,#c82333) !important;
            color: white !important;
            padding: 11px 24px !important;
            border-radius: 28px;
            font-weight: 800;
            box-shadow: 0 6px 20px rgba(220,53,69,0.5);
        }

        .logout:hover {
            background: linear-gradient(135deg,#c82333,#a71d2a) !important;
        }

        .top-bar > a[href="/login-admin"] {
            background: rgba(255,255,255,0.2) !important;
            color: white !important;
            padding: 11px 24px !important;
            border-radius: 28px;
            font-weight: 800;
            border: 2px solid rgba(255,255,255,0.3);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }

        .top-bar > a[href="/login-admin"]:hover {
            background: rgba(255,255,255,0.3) !important;
            border-color: rgba(255,255,255,0.5);
        }

        .mobile-menu-toggle {
            display: none;
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            font-size: 1.8rem;
            color: white;
            cursor: pointer;
            padding: 12px 16px;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
            transition: all 0.4s;
        }

        .mobile-menu-toggle:hover {
            transform: scale(1.1) rotate(90deg);
            background: rgba(255,255,255,0.3);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        /* ===== MAIN LAYOUT ===== */
        .main-wrapper {
            display: flex;
            min-height: calc(100vh - 90px);
            gap: 0;
            margin-top: 90px;
        }

        /* SIDEBAR */
        .sidebar {
            width: 260px;
            background: linear-gradient(135deg, rgba(26, 32, 44, 0.95), rgba(15, 23, 42, 0.95));
            backdrop-filter: blur(20px);
            border-right: 2px solid rgba(0, 229, 208, 0.2);
            overflow-y: auto;
            padding: 20px;
            transition: var(--transition);
            position: relative;
            flex-shrink: 0;
        }

        .sidebar-title {
            color: white;
            font-size: 0.85rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sidebar-menu {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 30px;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.08);
            border-left: 3px solid transparent;
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
            color: rgba(255, 255, 255, 0.8);
            font-weight: 600;
            font-size: 0.95rem;
        }

        .menu-item:hover {
            background: rgba(0, 180, 166, 0.2);
            border-left-color: var(--accent);
            color: white;
            transform: translateX(5px);
        }

        .menu-item.active {
            background: linear-gradient(135deg, rgba(0, 180, 166, 0.3), rgba(0, 229, 208, 0.2));
            border-left-color: var(--accent);
            color: white;
            box-shadow: 0 0 20px rgba(0, 229, 208, 0.2);
        }

        .menu-icon {
            font-size: 1.2rem;
            min-width: 24px;
        }

        .stats-panel {
            background: linear-gradient(135deg, rgba(0, 180, 166, 0.15), rgba(0, 229, 208, 0.1));
            border: 2px solid rgba(0, 229, 208, 0.2);
            border-radius: 15px;
            padding: 18px;
            margin-bottom: 25px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(0, 229, 208, 0.1);
        }

        .stat-row:last-child {
            margin-bottom: 0;
            border-bottom: none;
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.85rem;
            font-weight: 600;
        }

        .stat-value {
            color: var(--accent);
            font-size: 1.3rem;
            font-weight: 900;
        }

        .quick-actions {
            background: linear-gradient(135deg, rgba(0, 180, 166, 0.15), rgba(0, 229, 208, 0.1));
            border: 2px solid rgba(0, 229, 208, 0.2);
            border-radius: 15px;
            padding: 15px;
        }

        .quick-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            margin-bottom: 10px;
            transition: var(--transition);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .quick-btn:last-child {
            margin-bottom: 0;
        }

        .quick-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 180, 166, 0.3);
        }

        /* CONTENT AREA */
        .content-area {
            flex: 1;
            padding: 0;
            overflow-y: auto;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .content-section {
            display: none;
            animation: fadeInUp 0.5s ease-out;
            width: 100%;
            padding: 30px;
            min-height: 100%;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .content-section.active {
            display: flex;
            flex-direction: column;
        }

        .section-title {
            font-size: 2rem;
            font-weight: 800;
            color: white;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .section-title-icon {
            font-size: 2.5rem;
            animation: bounce 2s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* DASHBOARD SECTION */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            width: 100%;
        }

        .dashboard-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(247, 250, 252, 0.95));
            border-radius: 18px;
            padding: 25px;
            box-shadow: var(--shadow-md);
            border: 2px solid rgba(0, 229, 208, 0.3);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .dashboard-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
        }

        .dashboard-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
            border-color: rgba(0, 229, 208, 0.6);
        }

        .card-icon {
            font-size: 2.5rem;
            margin-bottom: 12px;
            display: inline-block;
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 8px;
        }

        .card-value {
            font-size: 2.2rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .card-description {
            font-size: 0.85rem;
            color: #718096;
            margin-top: 8px;
        }

        /* CAMERA SECTION FULL WIDTH */
        .camera-large-container {
            width: 100%;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(247, 250, 252, 0.95));
            border-radius: 25px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            margin-bottom: 30px;
            backdrop-filter: blur(20px);
            border: 2px solid rgba(0, 229, 208, 0.3);
            transition: var(--transition);
        }

        .camera-large-container:hover {
            box-shadow: 0 25px 70px rgba(0, 180, 166, 0.25);
            border-color: rgba(0, 229, 208, 0.5);
        }

        .camera-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            padding: 20px 25px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .camera-title {
            font-size: 1.3rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .camera-resolution {
            font-size: 0.85rem;
            background: rgba(255, 255, 255, 0.2);
            padding: 6px 14px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            font-weight: 600;
        }

        /* VIDEO WRAPPER - FULL WIDTH */
        .video-wrapper {
            position: relative;
            width: 100%;
            aspect-ratio: 16 / 9;
            background: #000;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #aiStream {
            width: 100%;
            height: 100%;
            object-fit: contain;
            background: #000;
            transition: var(--transition);
        }

        /* FLASH EFFECT */
        .video-wrapper.flash {
            animation: flashEffect 0.6s ease-out;
        }

        @keyframes flashEffect {
            0% {
                background: rgba(255, 255, 255, 0);
            }
            20% {
                background: rgba(255, 255, 255, 0.9);
                box-shadow: inset 0 0 100px rgba(255, 255, 255, 0.8), 0 0 100px rgba(0, 229, 208, 1);
            }
            100% {
                background: rgba(255, 255, 255, 0);
                box-shadow: inset 0 0 0px rgba(255, 255, 255, 0), 0 0 0px rgba(0, 229, 208, 0);
            }
        }

        /* SPARKLE EFFECT */
        .sparkle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: radial-gradient(circle, rgba(0, 229, 208, 1), transparent);
            border-radius: 50%;
            pointer-events: none;
            animation: sparkleAnimation 0.8s ease-out forwards;
        }

        @keyframes sparkleAnimation {
            0% {
                opacity: 1;
                transform: translate(0, 0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(var(--tx), var(--ty)) scale(0);
            }
        }

        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 15px;
            pointer-events: none;
        }

        .video-top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .video-stats {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            pointer-events: auto;
        }

        .stat-badge {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            color: white;
            padding: 8px 14px;
            border-radius: 10px;
            font-size: 0.75rem;
            font-weight: 700;
            border: 1px solid rgba(0, 229, 208, 0.4);
            display: flex;
            align-items: center;
            gap: 5px;
            animation: slideInDown 0.5s ease-out;
        }

        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .stat-value {
            color: var(--accent);
            font-weight: 800;
        }

        .video-controls-overlay {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 10px;
            z-index: 50;
            pointer-events: auto;
        }

        .control-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: 2px solid white;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
        }

        .control-btn:hover {
            background: rgba(0, 0, 0, 0.8);
            transform: scale(1.15);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.6);
        }

        /* CAMERA CONTROLS */
        .camera-controls {
            padding: 25px;
            background: white;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }

        .btn-camera {
            padding: 15px 20px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: var(--shadow-sm);
        }

        .btn-camera:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }

        .btn-success-camera {
            background: linear-gradient(135deg, var(--success) 0%, #38a169 100%);
            color: white;
        }

        .btn-info-camera {
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
            color: white;
        }

        .btn-warning-camera {
            background: linear-gradient(135deg, var(--warning) 0%, #dd6b20 100%);
            color: white;
        }

        .btn-danger-camera {
            background: linear-gradient(135deg, var(--danger) 0%, #e53e3e 100%);
            color: white;
        }

        /* UPLOAD SECTION */
        .upload-section {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(247, 250, 252, 0.95));
            border-radius: 20px;
            padding: 40px;
            box-shadow: var(--shadow-lg);
            margin-bottom: 40px;
            border: 2px solid rgba(0, 229, 208, 0.3);
            backdrop-filter: blur(20px);
            width: 100%;
        }

        .upload-zone {
            position: relative;
            border: 3px dashed var(--primary);
            border-radius: 18px;
            padding: 50px 30px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            background: linear-gradient(135deg, rgba(0, 180, 166, 0.05), rgba(0, 229, 208, 0.05));
            overflow: hidden;
        }

        .upload-zone::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent 30%, rgba(0, 229, 208, 0.1) 50%, transparent 70%);
            background-size: 200% 200%;
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { background-position: 200% 200%; }
            100% { background-position: -200% -200%; }
        }

        .upload-zone:hover {
            border-color: var(--accent);
            background: linear-gradient(135deg, rgba(0, 180, 166, 0.1), rgba(0, 229, 208, 0.1));
            box-shadow: inset 0 0 30px rgba(0, 229, 208, 0.15);
        }

        .upload-zone.dragover {
            border-color: var(--accent);
            background: linear-gradient(135deg, rgba(0, 180, 166, 0.15), rgba(0, 229, 208, 0.15));
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 3.5rem;
            margin-bottom: 15px;
            animation: bounceFile 2s ease-in-out infinite;
        }

        @keyframes bounceFile {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-15px) rotate(5deg); }
        }

        .upload-text {
            font-size: 1.2rem;
            font-weight: 700;
            color: #2d3748;
        }

        .file-input {
            display: none;
        }

        /* RESULTS & GALLERY */
        .results-section {
            display: none;
            animation: slideInUp 0.6s ease-out;
            width: 100%;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .results-section.active {
            display: block;
        }

        .results-container {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), rgba(247, 250, 252, 0.98));
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow-lg);
            border: 2px solid rgba(0, 229, 208, 0.3);
            width: 100%;
        }

        .result-image {
            width: 100%;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-md);
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .gallery-item {
            position: relative;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: var(--shadow-md);
            transition: var(--transition);
            background: white;
            cursor: pointer;
        }

        .gallery-item:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
        }

        .gallery-image {
            width: 100%;
            height: 160px;
            object-fit: cover;
            transition: var(--transition);
        }

        .gallery-item:hover .gallery-image {
            transform: scale(1.08);
        }

        .gallery-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.85);
            padding: 10px;
            display: flex;
            gap: 8px;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .gallery-item:hover .gallery-overlay {
            opacity: 1;
        }

        .gallery-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 700;
            transition: var(--transition);
        }

        .btn-download {
            background: var(--success);
            color: white;
        }

        .btn-delete {
            background: var(--danger);
            color: white;
        }

        /* LOADING & TOAST */
        .loading {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            text-align: center;
        }

        .loading.show {
            display: block;
        }

        .spinner-circle {
            width: 70px;
            height: 70px;
            border: 5px solid rgba(0, 180, 166, 0.2);
            border-top: 5px solid var(--accent);
            border-radius: 50%;
            animation: spin 1.2s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: var(--accent);
            font-weight: 800;
            font-size: 1.1rem;
            text-shadow: 0 2px 8px rgba(0, 180, 166, 0.3);
        }

        .toast {
            position: fixed;
            bottom: 25px;
            right: 25px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: var(--shadow-lg);
            display: none;
            align-items: center;
            gap: 10px;
            animation: slideInRight 0.4s ease-out;
            z-index: 2000;
            max-width: 350px;
            border-left: 5px solid var(--accent);
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .toast.show {
            display: flex;
        }

        .toast.error {
            background: linear-gradient(135deg, var(--danger), #e53e3e);
        }

        .toast.success {
            background: linear-gradient(135deg, var(--success), #38a169);
        }

        .toast-icon {
            font-size: 1.3rem;
            flex-shrink: 0;
        }

        .toast-message {
            font-weight: 600;
            font-size: 0.9rem;
        }

        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), rgba(247, 250, 252, 0.98));
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: var(--shadow-lg);
            border: 2px solid rgba(0, 229, 208, 0.3);
            animation: scaleIn 0.3s ease-out;
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .modal-header {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #718096;
            transition: var(--transition);
        }

        .modal-close:hover {
            color: var(--danger);
            transform: rotate(90deg);
        }

        .modal-body {
            color: #2d3748;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .modal-footer {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .modal-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
        }

        .modal-btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .modal-btn-secondary {
            background: #cbd5e0;
            color: #2d3748;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.4);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(0, 180, 166, 0.5);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 180, 166, 0.7);
        }

        /* RESPONSIVE */
        @media (max-width: 1200px) {
            .sidebar {
                width: 240px;
            }

            .camera-controls {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 900px) {
            .sidebar {
                position: fixed;
                left: 0;
                top: 90px;
                height: calc(100vh - 90px);
                z-index: 99;
                transform: translateX(-100%);
                transition: var(--transition);
                box-shadow: 5px 0 20px rgba(0, 0, 0, 0.3);
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .mobile-menu-toggle {
                display: flex;
            }

            .content-area {
                padding: 0;
            }

            .content-section {
                padding: 20px;
            }

            .camera-controls {
                grid-template-columns: repeat(2, 1fr);
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .gallery-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }

            .section-title {
                font-size: 1.5rem;
            }

            .video-wrapper {
                aspect-ratio: 4 / 3;
            }

            .top-bar {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .header {
                height: auto;
            }

            .header-container {
                height: auto;
                flex-direction: column;
                padding: 15px 20px;
            }

            .logo-icon {
                width: 75px;
                height: 75px;
            }

            .logo-text .main-title {
                font-size: 1.3rem;
            }

            .logo-text .subtitle {
                font-size: 0.88rem;
            }

            .user-greeting {
                display: none;
            }

            .sidebar {
                width: 100%;
            }

            .camera-controls {
                grid-template-columns: 1fr;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .gallery-grid {
                grid-template-columns: 1fr;
            }

            .content-section {
                padding: 15px;
            }

            .upload-section,
            .results-container,
            .camera-large-container {
                padding: 20px;
                border-radius: 15px;
            }

            .video-wrapper {
                aspect-ratio: 4 / 3;
            }
        }

        @media (max-width: 480px) {
            .section-title {
                font-size: 1.3rem;
            }

            .btn-camera {
                padding: 12px 16px;
                font-size: 0.9rem;
            }

            .gallery-grid {
                grid-template-columns: 1fr;
            }

            .camera-header {
                flex-direction: column;
                gap: 10px;
            }
        }
        .logo-icon {
  width: 90px;  /* sesuaikan ukuran */
  height: 90px;
  background-image: url('/LOKO ASIK.png');
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center center;
}

    </style>
</head>
<body>
    <!-- HEADER -->
    <header class="header" id="header">
        <div class="header-container">
            <div class="logo-section" onclick="window.location.href='/home'">
                <div class="logo-icon"></div>
                <div class="logo-text">
                    <span class="main-title">Fish Detector</span>
                    <span class="subtitle">Pulau Tunda, Banten</span>
                </div>
            </div>
            <button class="mobile-menu-toggle" id="menuToggle">‚ò∞</button>
            <div class="top-bar" id="topBar">
                <div class="user-greeting">
                    <span class="greeting-text">Halo, Pengguna üëã</span>
                </div>
                <a href="/home">Home</a>
                <details id="ekosistemDetails">
                    <summary>Ekosistem</summary>
                    <ul>
                        <li><a href="/mangrove2019">üå≥ Mangrove</a></li>
                        <li><a href="/lamun2019">üåø Lamun</a></li>
                        <li><a href="/Terumbu2019">ü™∏ Terumbu Karang</a></li>
                        <li><a href="/zpi">üêü Ikan</a></li>
                    </ul>
                </details>
                <details id="prediksiDetails">
                    <summary>Prediksi</summary>
                    <ul>
                        <li><a href="/prediksimangrove">üå≥ Mangrove</a></li>
                        <li><a href="/prediksilamun">üåø Lamun</a></li>
                        <li><a href="/prediksiterumbu">ü™∏ Terumbu Karang</a></li>
                        <li><a href="/ekosistemikan">üêü Ikan</a></li>
                    </ul>
                </details>
                <details id="faqDetails">
                    <summary>FAQ</summary>
                    <ul>
                        <li><a href="/faq">ü§ñ BADU AI</a></li>
                        <li><a href="/voice">üó£Ô∏è Translate</a></li>
                        <li><a href="/kamera-ikan">üìπ Kamera</a></li>
                        <li><a href="/kameraikan">üì∞ Artikel Populer</a></li>
                    </ul>
                </details>
                <a href="/logout" class="logout" onclick="return confirm('Apakah Anda yakin ingin logout?')">Logout</a>
                <a href="/login-admin">Login Admin</a>
            </div>
        </div>
    </header>

    <!-- MAIN WRAPPER -->
    <div class="main-wrapper">
        <!-- SIDEBAR -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-title">
                <span>üìã</span> Menu Utama
            </div>
            <div class="sidebar-menu">
                <div class="menu-item active" onclick="showSection('dashboard')">
                    <span class="menu-icon">üìä</span> Dashboard
                </div>
                <div class="menu-item" onclick="showSection('camera')">
                    <span class="menu-icon">üìπ</span> Kamera Live
                </div>
                <div class="menu-item" onclick="showSection('upload')">
                    <span class="menu-icon">üì§</span> Upload Gambar
                </div>
                <div class="menu-item" onclick="showSection('gallery')">
                    <span class="menu-icon">üñºÔ∏è</span> Galeri
                </div>
            </div>

            <div class="sidebar-title">
                <span>‚öôÔ∏è</span> Pengaturan
            </div>
            <div class="sidebar-menu">
                <div class="menu-item" onclick="openModal('settings')">
                    <span class="menu-icon">üéØ</span> Deteksi
                </div>
                <div class="menu-item" onclick="openModal('info')">
                    <span class="menu-icon">‚ÑπÔ∏è</span> Info Sistem
                </div>
                <div class="menu-item" onclick="openModal('help')">
                    <span class="menu-icon">‚ùì</span> Bantuan
                </div>
            </div>
            

            <div class="quick-actions">
                <button class="quick-btn" onclick="startAIDetection()">
                    <span>‚ñ∂Ô∏è</span> Start
                </button>
                <button class="quick-btn" onclick="stopAIDetection()">
                    <span>‚èπÔ∏è</span> Stop
                </button>
                <button class="quick-btn" onclick="captureFromAI()">
                    <span>üì∏</span> Capture
                </button>
            </div>
        </div>

        <!-- CONTENT AREA -->
        <div class="content-area">
            <!-- DASHBOARD SECTION -->
            <div id="dashboard" class="content-section active">
                <div class="section-title">
                    <span class="section-title-icon">üìä</span> Dashboard Kontrol
                </div>

                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <div class="card-icon">üìπ</div>
                        <div class="card-title">Kamera Live</div>
                        <div class="card-value" id="cameraStatus">Ready</div>
                        <div class="card-description">Real-time detection active</div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-icon">üéØ</div>
                        <div class="card-title">Deteksi Total</div>
                        <div class="card-value" id="detectionTotal">0</div>
                        <div class="card-description">Gambar yang diproses</div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-icon">‚úÖ</div>
                        <div class="card-title">Ikan Segar</div>
                        <div class="card-value" id="freshCount">0</div>
                        <div class="card-description">Hasil deteksi positif</div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-icon">‚ùå</div>
                        <div class="card-title">Tidak Segar</div>
                        <div class="card-value" id="notFreshCount">0</div>
                        <div class="card-description">Hasil deteksi negatif</div>
                    </div>
                </div>
            </div>

            <!-- CAMERA SECTION - FULL WIDTH -->
            <div id="camera" class="content-section">
                <div class="section-title">
                    <span class="section-title-icon">üìπ</span> Kamera Live Detection
                </div>

                <div class="camera-large-container">
                    <div class="camera-header">
                        <div class="camera-title">
                            <span>üé•</span> Real-Time AI Stream
                        </div>
                        <div class="camera-resolution">1080P ‚Ä¢ 30FPS ‚Ä¢ LIVE</div>
                    </div>
                    <div class="video-wrapper" id="videoWrapper">
                        <img id="aiStream" src="" alt="AI Detection Stream">
                        <div class="video-overlay">
                            <div class="video-top-bar">
                                <div class="video-stats">
                                    <div class="stat-badge">
                                        <span>üéØ</span> FPS: <span class="stat-value">30</span>
                                    </div>
                                    <div class="stat-badge">
                                        <span>‚ö°</span> Latency: <span class="stat-value">45ms</span>
                                    </div>
                                </div>
                                <div class="video-controls-overlay">
                                    <button class="control-btn" id="btnSettings" title="Settings">‚öôÔ∏è</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="camera-controls">
                        <button class="btn-camera btn-success-camera" onclick="startAIDetection()">
                            ‚ñ∂Ô∏è Start
                        </button>
                        <button class="btn-camera btn-info-camera" onclick="captureFromAI()">
                            üì∏ Capture
                        </button>
                        <button class="btn-camera btn-warning-camera" onclick="switchCamera()">
                            üîÑ Switch
                        </button>
                        <button class="btn-camera btn-danger-camera" onclick="stopAIDetection()">
                            ‚èπÔ∏è Stop
                        </button>
                    </div>
                </div>
            </div>

            <!-- UPLOAD SECTION -->
            <div id="upload" class="content-section">
                <div class="section-title">
                    <span class="section-title-icon">üì§</span> Upload & Analisis
                </div>

                <div class="upload-section">
                    <div class="upload-zone" id="uploadZone">
                        <div class="upload-content">
                            <div class="upload-icon">üì§</div>
                            <div class="upload-text">Klik atau Drag & Drop Gambar</div>
                            <div style="margin-top: 12px; color: #718096; font-size: 0.95rem;">
                                Mendukung JPG, PNG, JPEG (Max 10MB)
                            </div>
                        </div>
                        <input type="file" id="fileInput" class="file-input" accept="image/*">
                    </div>

                    <div class="results-section" id="resultsSection">
                        <div class="results-container">
                            <h2 style="font-size: 1.3rem; font-weight: 700; color: #2d3748; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                                <span>üìä</span> Hasil Analisis
                            </h2>
                            <img id="resultImage" class="result-image" alt="Detection Result" style="display: none;">
                            <div id="detectionSummary"></div>
                            <div id="detectionResults"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- GALLERY SECTION -->
            <div id="gallery" class="content-section">
                <div class="section-title">
                    <span class="section-title-icon">üñºÔ∏è</span> Galeri Gambar
                </div>

                <div class="results-container">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2 style="font-size: 1.2rem; font-weight: 700; color: #2d3748;">Koleksi Deteksi</h2>
                        <button class="btn-camera btn-info-camera" onclick="loadGallery()" style="width: auto;">
                            üîÑ Refresh
                        </button>
                    </div>
                    <div class="gallery-grid" id="galleryGrid">
                        <div style="text-align: center; padding: 40px; color: #718096; grid-column: 1/-1;">
                            <div style="font-size: 3rem; margin-bottom: 10px;">üñºÔ∏è</div>
                            <div style="font-weight: 600;">Belum ada gambar tersimpan</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- LOADING INDICATOR -->
    <div class="loading" id="loadingIndicator">
        <div class="spinner-circle"></div>
        <div class="loading-text">ü§ñ Processing...</div>
    </div>

    <!-- TOAST NOTIFICATION -->
    <div class="toast" id="toast"></div>

    <!-- MODALS -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <span>‚öôÔ∏è Pengaturan Deteksi</span>
                <button class="modal-close" onclick="closeModal('settings')">‚úï</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 15px;">
                    <strong>Confidence Threshold:</strong><br>
                    <input type="range" min="0" max="100" value="75" style="width: 100%; margin-top: 10px;"> 
                    <span id="confidenceValue">75%</span>
                </p>
                <p style="margin-bottom: 15px;">
                    <strong>Deteksi Otomatis:</strong><br>
                    <label style="display: flex; align-items: center; gap: 8px; margin-top: 10px;">
                        <input type="checkbox" checked>
                        <span>Aktifkan deteksi berkelanjutan</span>
                    </label>
                </p>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" onclick="closeModal('settings')">Batal</button>
                <button class="modal-btn modal-btn-primary" onclick="closeModal('settings'); showToast('Pengaturan disimpan!', 'success', '‚úÖ')">Simpan</button>
            </div>
        </div>
    </div>

    <div class="modal" id="infoModal">
        <div class="modal-content">
            <div class="modal-header">
                <span>‚ÑπÔ∏è Informasi Sistem</span>
                <button class="modal-close" onclick="closeModal('info')">‚úï</button>
            </div>
            <div class="modal-body">
                <p><strong>Versi:</strong> 4.0.0 Pro</p>
                <p><strong>Model AI:</strong> YOLOv8 Fine-tuned</p>
                <p><strong>Akurasi:</strong> 98.5%</p>
                <p><strong>Resolusi:</strong> 1080P</p>
                <p><strong>FPS:</strong> 30</p>
                <p><strong>Status:</strong> ‚úÖ Online</p>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-primary" onclick="closeModal('info')">Tutup</button>
            </div>
        </div>
    </div>

    <div class="modal" id="helpModal">
        <div class="modal-content">
            <div class="modal-header">
                <span>‚ùì Bantuan & Panduan</span>
                <button class="modal-close" onclick="closeModal('help')">‚úï</button>
            </div>
            <div class="modal-body">
                <p><strong>üìπ Cara Menggunakan Kamera:</strong><br>
                   1. Klik tombol "Start" untuk memulai stream<br>
                   2. Arahkan kamera ke ikan<br>
                   3. Klik "Capture" untuk analisis</p>
                
                <p style="margin-top: 15px;"><strong>üì§ Cara Upload Gambar:</strong><br>
                   1. Buka tab "Upload Gambar"<br>
                   2. Drag & drop atau klik area upload<br>
                   3. Tunggu hasil analisis</p>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-primary" onclick="closeModal('help')">Tutup</button>
            </div>
        </div>
    </div>

    <script>
        let aiStreamActive = false;
        let currentFilename = null;
        let stats = { total: 0, fresh: 0, notFresh: 0 };
        const API_BASE = '/api/fish';

        console.log('üöÄ AI Fish Detector PRO v4 - With Premium Header');

        // ===== HEADER FUNCTIONALITY =====
        const header = document.getElementById('header');
        const menuToggle = document.getElementById('menuToggle');
        const topBar = document.getElementById('topBar');
        const sidebar = document.getElementById('sidebar');

        // Header scroll effect
        window.addEventListener('scroll', () => {
            if (window.pageYOffset > 60) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
        });

        // Mobile menu toggle
        if (menuToggle && topBar) {
            menuToggle.addEventListener('click', (e) => {
                e.stopPropagation();
                topBar.classList.toggle('active');
                menuToggle.textContent = topBar.classList.contains('active') ? '‚úï' : '‚ò∞';
            });
        }

        // Close dropdowns on outside click
        document.addEventListener('click', (e) => {
            document.querySelectorAll('details[open]').forEach(detail => {
                if (!detail.contains(e.target)) detail.removeAttribute('open');
            });
            if (topBar && menuToggle && !topBar.contains(e.target) && !menuToggle.contains(e.target)) {
                topBar.classList.remove('active');
                menuToggle.textContent = '‚ò∞';
            }
            if (sidebar && !sidebar.contains(e.target) && !menuToggle.contains(e.target) && window.innerWidth <= 900) {
                sidebar.classList.remove('active');
            }
        });

        // One open dropdown at a time
        document.querySelectorAll('details').forEach(detail => {
            detail.addEventListener('click', (e) => e.stopPropagation());
            detail.addEventListener('toggle', () => {
                if (detail.open) {
                    document.querySelectorAll('details').forEach(other => {
                        if (other !== detail && other.open) other.removeAttribute('open');
                    });
                }
            });
        });

        // Auto-close mobile menu on link click
        document.querySelectorAll('.top-bar a').forEach(link => {
            link.addEventListener('click', () => {
                if (window.innerWidth <= 1024 && topBar) {
                    topBar.classList.remove('active');
                    if (menuToggle) menuToggle.textContent = '‚ò∞';
                }
            });
        });

        // Sidebar menu toggle
        if (menuToggle) {
            menuToggle.addEventListener('click', () => {
                sidebar.classList.toggle('active');
            });
        }

        // ===== DETECTOR FUNCTIONALITY =====

        // SOUND EFFECT
        function playShutterSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const now = audioContext.currentTime;
                
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                
                osc.frequency.setValueAtTime(800, now);
                osc.frequency.exponentialRampToValueAtTime(200, now + 0.1);
                
                gain.gain.setValueAtTime(0.3, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                
                osc.connect(gain);
                gain.connect(audioContext.destination);
                
                osc.start(now);
                osc.stop(now + 0.1);
            } catch (e) {
                console.log('Audio context not available');
            }
        }

        // FLASH EFFECT & SPARKLES
        function triggerFlashEffect() {
            const videoWrapper = document.getElementById('videoWrapper');
            videoWrapper.classList.add('flash');
            
            setTimeout(() => {
                videoWrapper.classList.remove('flash');
            }, 600);
            
            createSparkles();
            playShutterSound();
        }

        function createSparkles() {
            const videoWrapper = document.getElementById('videoWrapper');
            
            for (let i = 0; i < 20; i++) {
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle';
                
                const angle = (Math.random() * Math.PI * 2);
                const distance = Math.random() * 150 + 50;
                const tx = Math.cos(angle) * distance;
                const ty = Math.sin(angle) * distance;
                
                sparkle.style.setProperty('--tx', tx + 'px');
                sparkle.style.setProperty('--ty', ty + 'px');
                
                sparkle.style.left = '50%';
                sparkle.style.top = '50%';
                sparkle.style.marginLeft = '-5px';
                sparkle.style.marginTop = '-5px';
                
                videoWrapper.appendChild(sparkle);
                
                setTimeout(() => sparkle.remove(), 800);
            }
        }

        // UTILITY FUNCTIONS
        function showToast(message, type = 'success', icon = '‚úÖ') {
            const toast = document.getElementById('toast');
            toast.innerHTML = `<span class="toast-icon">${icon}</span><span class="toast-message">${message}</span>`;
            toast.className = `toast show ${type}`;
            setTimeout(() => toast.classList.remove('show'), 4000);
        }

        function showLoading(show) {
            document.getElementById('loadingIndicator').classList.toggle('show', show);
        }

        function showSection(sectionId) {
            document.querySelectorAll('.content-section').forEach(el => el.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            
            document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));
            event?.target?.closest('.menu-item')?.classList.add('active');

            if (window.innerWidth <= 900) {
                sidebar.classList.remove('active');
            }
        }

        function openModal(modalId) {
            document.getElementById(modalId + 'Modal').classList.add('show');
        }

        function closeModal(modalId) {
            document.getElementById(modalId + 'Modal').classList.remove('show');
        }

        function updateStats() {
            document.getElementById('statTotal').textContent = stats.total;
            document.getElementById('statFresh').textContent = stats.fresh;
            document.getElementById('statNotFresh').textContent = stats.notFresh;
            document.getElementById('detectionTotal').textContent = stats.total;
            document.getElementById('freshCount').textContent = stats.fresh;
            document.getElementById('notFreshCount').textContent = stats.notFresh;
        }

        // CAMERA FUNCTIONS
        function startAIDetection() {
            const stream = document.getElementById('aiStream');
            stream.src = `${API_BASE}/video_feed?t=${Date.now()}`;
            aiStreamActive = true;
            document.getElementById('cameraStatus').textContent = 'Aktif';
            showToast('üé• Deteksi dimulai!', 'success', '‚ñ∂Ô∏è');
        }

        function stopAIDetection() {
            document.getElementById('aiStream').src = '';
            aiStreamActive = false;
            document.getElementById('cameraStatus').textContent = 'Standby';
            showToast('‚èπÔ∏è Deteksi dihentikan - Kamera mati', 'success', '‚úì');
        }

        function switchCamera() {
            if (!aiStreamActive) {
                showToast('Mulai deteksi terlebih dahulu!', 'error', '‚ö†Ô∏è');
                return;
            }
            stopAIDetection();
            setTimeout(() => {
                startAIDetection();
                showToast('üîÑ Kamera berhasil diubah!', 'success', 'üìπ');
            }, 500);
        }

        async function captureFromAI() {
            if (!aiStreamActive) {
                showToast('Mulai deteksi terlebih dahulu!', 'error', '‚ö†Ô∏è');
                return;
            }
            
            triggerFlashEffect();
            showLoading(true);
            
            try {
                const response = await fetch(`${API_BASE}/capture_snapshot`, { method: 'POST' });
                const data = await response.json();
                if (data.success) {
                    displayResults(data);
                    loadGallery();
                    stats.total++;
                    if (data.detections?.length > 0) stats.fresh++;
                    updateStats();
                    showToast('‚ú® Gambar berhasil dianalisis!', 'success', 'üì∏');
                } else {
                    showToast('Error: ' + data.error, 'error', '‚ùå');
                }
            } catch (err) {
                showToast('Koneksi gagal!', 'error', '‚ùå');
            } finally {
                showLoading(false);
            }
        }

        // UPLOAD FUNCTIONS
        const uploadZone = document.getElementById('uploadZone');
        const fileInput = document.getElementById('fileInput');

        uploadZone.addEventListener('click', () => fileInput.click());
        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        });
        uploadZone.addEventListener('dragleave', () => uploadZone.classList.remove('dragover'));
        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
            if (e.dataTransfer.files.length) {
                fileInput.files = e.dataTransfer.files;
                uploadImage();
            }
        });

        fileInput.addEventListener('change', uploadImage);

        async function uploadImage() {
            const file = fileInput.files[0];
            if (!file) return;

            const formData = new FormData();
            formData.append('image', file);

            showLoading(true);
            try {
                const response = await fetch(`${API_BASE}/detect_image`, { method: 'POST', body: formData });
                const data = await response.json();
                if (data.success) {
                    displayResults(data);
                    stats.total++;
                    if (data.detections?.length > 0) stats.fresh++;
                    updateStats();
                    showToast('üéâ Analisis selesai!', 'success', '‚ú®');
                } else {
                    showToast('Error: ' + data.error, 'error', '‚ùå');
                }
            } catch (err) {
                showToast('Upload gagal!', 'error', '‚ùå');
            } finally {
                showLoading(false);
                fileInput.value = '';
            }
        }

        // DISPLAY RESULTS
        function displayResults(data) {
            const resultsSection = document.getElementById('resultsSection');
            const resultImage = document.getElementById('resultImage');
            const detectionResults = document.getElementById('detectionResults');
            const detectionSummary = document.getElementById('detectionSummary');

            if (data.image) {
                resultImage.src = `data:image/jpeg;base64,${data.image}`;
                resultImage.style.display = 'block';
            }

            currentFilename = data.filename;

            let summaryHTML = '';
            let resultsHTML = '';

            if (data.detections && data.detections.length > 0) {
                const fresh = data.detections.filter(d => d.class.toLowerCase().includes('segar') && !d.class.toLowerCase().includes('tidak')).length;
                const notFresh = data.detections.filter(d => d.class.toLowerCase().includes('tidak')).length;

                summaryHTML = `
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;">
                        <div style="background: linear-gradient(135deg, #4299e1, #3182ce); color: white; padding: 15px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 0.9rem; opacity: 0.9;">Total</div>
                            <div style="font-size: 1.8rem; font-weight: 900;">${data.detections.length}</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #48bb78, #38a169); color: white; padding: 15px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 0.9rem; opacity: 0.9;">Segar</div>
                            <div style="font-size: 1.8rem; font-weight: 900;">${fresh}</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #f56565, #e53e3e); color: white; padding: 15px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 0.9rem; opacity: 0.9;">Tidak Segar</div>
                            <div style="font-size: 1.8rem; font-weight: 900;">${notFresh}</div>
                        </div>
                    </div>
                `;

                data.detections.forEach((det, index) => {
                    const className = det.class || '';
                    const isFresh = className.toLowerCase().includes('segar') && !className.toLowerCase().includes('tidak');
                    
                    resultsHTML += `
                        <div style="background: white; border-left: 4px solid ${isFresh ? '#48bb78' : '#f56565'}; padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                            <div style="font-weight: 700; margin-bottom: 8px;">Deteksi #${index + 1}</div>
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <span style="background: ${isFresh ? '#c6f6d5' : '#fed7d7'}; color: ${isFresh ? '#22543d' : '#742a2a'}; padding: 6px 12px; border-radius: 15px; font-size: 0.85rem; font-weight: 700;">${className}</span>
                                <span style="background: #bee3f8; color: #2c5282; padding: 6px 12px; border-radius: 15px; font-size: 0.85rem; font-weight: 700;">Confidence: ${(det.confidence * 100).toFixed(1)}%</span>
                            </div>
                        </div>
                    `;
                });
            }

            detectionSummary.innerHTML = summaryHTML;
            detectionResults.innerHTML = resultsHTML;
            resultsSection.classList.add('active');
        }

        // GALLERY FUNCTIONS
        async function loadGallery() {
            try {
                const response = await fetch(`${API_BASE}/list_images`);
                const data = await response.json();
                const galleryGrid = document.getElementById('galleryGrid');
                galleryGrid.innerHTML = '';

                if (data.images && data.images.length > 0) {
                    data.images.forEach(img => {
                        const item = document.createElement('div');
                        item.className = 'gallery-item';
                        item.innerHTML = `
                            <img src="${API_BASE}${img.path}" class="gallery-image">
                            <div class="gallery-overlay">
                                <button class="gallery-btn btn-download" onclick="window.open('${API_BASE}${img.path}', '_blank')">üíæ</button>
                                <button class="gallery-btn btn-delete" onclick="deleteGalleryImage('${img.filename}')">üóëÔ∏è</button>
                            </div>
                        `;
                        galleryGrid.appendChild(item);
                    });
                } else {
                    galleryGrid.innerHTML = `<div style="text-align: center; padding: 40px; color: #718096; grid-column: 1/-1;"><div style="font-size: 3rem; margin-bottom: 10px;">üñºÔ∏è</div><div style="font-weight: 600;">Belum ada gambar</div></div>`;
                }
            } catch (err) {
                console.error(err);
            }
        }

        async function deleteGalleryImage(filename) {
            if (confirm('Hapus gambar ini?')) {
                try {
                    await fetch(`${API_BASE}/delete/${filename}`, { method: 'DELETE' });
                    loadGallery();
                    showToast('Gambar dihapus', 'success', 'üóëÔ∏è');
                } catch (err) {
                    showToast('Gagal menghapus', 'error', '‚ùå');
                }
            }
        }

        // MODAL CLOSE ON OUTSIDE CLICK
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.classList.remove('show');
            });
        });

        // AUTO LOAD
        window.addEventListener('load', () => {
            loadGallery();
            updateStats();
        });

        // KEYBOARD SHORTCUTS
        document.addEventListener('keydown', (e) => {
            if (e.key === 's' && e.ctrlKey) {
                e.preventDefault();
                captureFromAI();
            }
            if (e.key === 'Escape') stopAIDetection();
        });
    </script>
</body>
</html>